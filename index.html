<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kilometers For Khmer — Charity Run 2025 | Registration</title>
  <meta name="description" content="Register for Kilometers For Khmer Charity Run 2025. 5K $15 • 7K $17. October 4, 2025, Eco Park 1, Phnom Penh.">
  <style>
    :root { --bg:#0b0d12; --text:#e9eef7; --muted:#9fb0c9; --accent:#facc15; --accent2:#60a5fa; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:radial-gradient(1200px 800px at 20% -10%,#132544 0%,#0b0d12 60%),var(--bg);color:var(--text);line-height:1.55}
    header{padding:42px 18px 10px;text-align:center}
    .title{font-size:clamp(28px,4vw,44px);margin:0 0 6px}
    .sub{color:var(--muted);margin:0}
    .container{max-width:900px;margin:22px auto 64px;padding:0 18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:18px}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .row-1{display:grid;gap:12px;grid-template-columns:1fr}
    label{display:block;font-weight:600;margin:8px 0 4px}
    input,select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0f1320;color:var(--text)}
    .muted{color:var(--muted);font-size:14px;margin:8px 0 0}
    .pill{display:inline-block;margin:6px 6px 0 0;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
    .cta{margin-top:14px;padding:12px 16px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#0b0d12;font-weight:800;cursor:pointer}
    .ok{color:#67f08a}.err{color:#ff8282}
    footer{text-align:center;color:var(--muted);font-size:13px;padding:36px 20px 60px}
  </style>
</head>
<body>
  <header>
    <h1 class="title">Kilometers For Khmer — Charity Run 2025</h1>
    <p class="sub">Eco Park 1, Phnom Penh • Sunday, 4 October 2025</p>
    <p class="pill">Distances & Fees: 5K — $15 • 7K — $17</p>
  </header>

  <main class="container">
    <section class="card">
      <h2 style="margin:6px 0 14px">Registration Form</h2>
      <form id="reg" aria-label="Kilometers For Khmer registration">
        <div class="row">
          <div>
            <label for="name">Full name *</label>
            <input id="name" name="name" required />
          </div>
          <div>
            <label for="email">Email *</label>
            <input id="email" name="email" type="email" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="phone">Phone / Telegram</label>
            <input id="phone" name="phone" />
          </div>
          <div>
            <label for="distance">Distance *</label>
            <select id="distance" name="distance" required>
              <option value="">Pick distance</option>
              <option>5K ($15)</option>
              <option>7K ($17)</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="tshirt">T-shirt size</label>
            <select id="tshirt" name="tshirt">
              <option value="">Select size</option>
              <option>S</option><option>M</option><option>L</option><option>XL</option>
            </select>
          </div>
          <div>
            <label for="emergency">Emergency contact</label>
            <input id="emergency" name="emergency" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="paymentRef">Payment reference *</label>
            <input id="paymentRef" name="paymentRef" placeholder="e.g., ABA txn ID / sender name" required />
          </div>
          <div>
            <label for="proof">Proof of payment (image/PDF, max 8 MB) *</label>
            <input id="proof" name="proof" type="file" accept="image/*,application/pdf" required />
          </div>
        </div>

        <div class="row-1">
          <label><input type="checkbox" name="waiver" value="Agreed" required /> I agree to the event waiver/terms *</label>
          <p class="muted">You’ll receive a confirmation message on successful submission.</p>
          <button class="cta" type="submit">Submit Registration</button>
          <p id="msg" class="muted"></p>
        </div>
      </form>
    </section>
  </main>

  <footer>
    © <span id="y"></span> Kilometers For Khmer
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    const SCRIPT_URL = 'YOUR_SCRIPT_URL_HERE'; // <-- paste Apps Script Web App URL
    const form = document.getElementById('reg');
    const msg  = document.getElementById('msg');
    const MAX_MB = 8;

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onerror = () => reject('Failed to read file');
        reader.onload = () => {
          const result = reader.result; // "data:<mime>;base64,AAAA..."
          const b64 = String(result).split(',')[1]; // strip "data:*;base64,"
          resolve(b64);
        };
        reader.readAsDataURL(file);
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = 'Submitting...';
      msg.className = 'muted';

      try {
        const file = document.getElementById('proof').files[0];
        if (!file) throw new Error('Please attach proof of payment.');
        if (file.size > MAX_MB * 1024 * 1024) {
          throw new Error(`File too large. Max ${MAX_MB} MB.`);
        }

        const file_b64 = await toBase64(file);

        // Build URL-encoded payload (no CORS preflight)
        const data = new URLSearchParams();
        data.set('name', document.getElementById('name').value.trim());
        data.set('email', document.getElementById('email').value.trim());
        data.set('phone', document.getElementById('phone').value.trim());
        data.set('distance', document.getElementById('distance').value);
        data.set('tshirt', document.getElementById('tshirt').value);
        data.set('emergency', document.getElementById('emergency').value.trim());
        data.set('waiver', form.waiver.checked ? 'Agreed' : '');
        data.set('paymentRef', document.getElementById('paymentRef').value.trim());
        data.set('file_name', file.name);
        data.set('file_type', file.type || 'application/octet-stream');
        data.set('file_b64', file_b64);

        const res = await fetch(SCRIPT_URL, { method: 'POST', body: data });
        const text = await res.text();
        if (!res.ok || !/^OK/.test(text)) {
          throw new Error(text || 'Submission failed');
        }

        msg.textContent = '✅ Registered! We received your details and proof of payment.';
        msg.className = 'muted ok';
        form.reset();
      } catch (err) {
        msg.textContent = '❌ ' + (err.message || err);
        msg.className = 'muted err';
      }
    });
  </script>
</body>
</html>
